const ONE_HOUR=36e5,SERVER="https://astro-server-z1u9.onrender.com/traffic-data",checkLastSent=()=>{let e=localStorage.getItem("lastSent");if(!e)return!0;let t=new Date().getTime(),n=new Date(e).getTime();return t-n>36e5},updateLastSent=()=>{localStorage.setItem("lastSent",new Date().toISOString())},getDeviceType=()=>{let e=navigator.userAgent;return/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?"mobile":/iPad/i.test(e)?"tablet":"desktop"},getIpAddress=async()=>await fetch("https://api.ipify.org?format=json").then(e=>e.json()).then(e=>e.ip),displayConsentBanner=(e,t,n)=>{if(document.getElementById("consent-accept"))return;let i=localStorage.getItem("analytics-consent");if("declined"===i)return;let o=document.createElement("div");o.innerHTML=`
  <div style="position: fixed; bottom: 0; background: #000; color: #fff; width: 100%; padding: 15px; text-align: center; z-index: 9999;">
  Our website uses cookies to analyze traffic and personalize your experience.<br>
  <span style="font-size: 12px;">We only collect basic information such as device type and screen size to help us optimize your experience on our site. We do not collect personally identifiable information.</span>
  <button id="consent-accept" style="background: #4CAF50; border: none; color: white; padding: 5px 10px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer;">Accept</button>
  <button id="consent-decline" style="background: #f44336; border: none; color: white; padding: 5px 10px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer;">Decline</button>
</div>
  `,document.body.appendChild(o),o.querySelector("#consent-accept").addEventListener("click",()=>{localStorage.setItem("analytics-consent","accepted"),o.remove(),setTimeout(()=>e(),0)}),o.querySelector("#consent-decline").addEventListener("click",async()=>{localStorage.setItem("analytics-consent","declined"),o.remove();let e={siteName:t,date:new Date().toISOString(),noConsent:!0};try{let i=await fetch(SERVER,{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":n},body:JSON.stringify(e)});if(!i.ok)throw Error(`Error sending data to the server: ${i.statusText}`)}catch(r){console.error(r)}})},checkConsent=(e=!1)=>{if(e)return!0;let t=localStorage.getItem("analytics-consent");return"accepted"===t},getLocationData=async e=>{try{let t=await fetch(`https://ipapi.co/${e}/json/`),n=await t.json();return{country:n.country_name,region:n.region,city:n.city,latitude:n.latitude,longitude:n.longitude}}catch(i){return console.error("Error getting location data: ",i),null}};async function analytics(e,t){try{if(!checkLastSent())return;if(!checkConsent()){displayConsentBanner(()=>analytics(e,t),e,t);return}let n=await getIpAddress(),i=await getLocationData(n),o={siteName:e,date:new Date().toISOString(),screenSize:{width:window.innerWidth,height:window.innerHeight},deviceType:getDeviceType(),location:i},r=await fetch(SERVER,{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":t},body:JSON.stringify(o)});if(!r.ok)throw Error(`Error sending data to the server: ${r.statusText}`);updateLastSent()}catch(a){console.error(a)}}"undefined"!=typeof module&&(module.exports=analytics),"undefined"!=typeof window&&(window.analytics=analytics);