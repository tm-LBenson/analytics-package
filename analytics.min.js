const ONE_HOUR=36e5,checkLastSent=()=>{let e=localStorage.getItem("lastSent");if(!e)return!0;let t=new Date().getTime(),n=new Date(e).getTime();return t-n>36e5},updateLastSent=()=>{localStorage.setItem("lastSent",new Date().toISOString())},getDeviceType=()=>{let e=navigator.userAgent;return/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?"mobile":/iPad/i.test(e)?"tablet":"desktop"},getIpAddress=async()=>await fetch("https://api.ipify.org?format=json").then(e=>e.json()).then(e=>e.ip),displayConsentBanner=e=>{if(document.getElementById("consent-accept"))return;let t=document.createElement("div");t.innerHTML=`
    <div style="position: fixed; bottom: 0; background: #000; color: #fff; width: 100%; padding: 15px; text-align: center; z-index: 9999;">
      We use cookies to collect analytics data.
      <button id="consent-accept" style="background: #4CAF50; border: none; color: white; padding: 5px 10px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer;">Accept</button>
      <button id="consent-decline" style="background: #f44336; border: none; color: white; padding: 5px 10px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer;">Decline</button>
    </div>
  `,document.body.appendChild(t),console.log("Displaying consent banner"),t.querySelector("#consent-accept").addEventListener("click",()=>{localStorage.setItem("analytics-consent","accepted"),t.remove(),setTimeout(()=>e(),0)}),t.querySelector("#consent-decline").addEventListener("click",()=>{localStorage.setItem("analytics-consent","declined"),t.remove()})},checkConsent=(e=!1)=>{if(e)return!0;let t=localStorage.getItem("analytics-consent");return"accepted"===t};async function analytics(e,t){console.log(e+" analytics",t);try{if(!checkLastSent())return;if(!checkConsent()){displayConsentBanner(()=>analytics(e,t));return}let n=await getIpAddress(),i={siteName:e,date:new Date().toISOString(),screenSize:{width:window.innerWidth,height:window.innerHeight},deviceType:getDeviceType(),ipAddress:n},o=await fetch("https://astro-server-z1u9.onrender.com/traffic-data",{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":t},body:JSON.stringify(i)});if(console.log(o),!o.ok)throw console.log("Error sending data to the server: "+o.statusText),Error(`Error sending data to the server: ${o.statusText}`);updateLastSent()}catch(r){console.error(r)}}"undefined"!=typeof module&&(module.exports=analytics),"undefined"!=typeof window&&(window.analytics=analytics);